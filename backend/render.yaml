# backend/render.yaml
# Render configuration for deploying Django (SQLite + Whitenoise, no Docker)

services:
  - type: web
    name: ecommerce-product-api
    env: python
    plan: free

    # ‚úÖ Render will treat /backend as the working directory
    rootDir: backend

    # üß© Build Phase ‚Äî install dependencies
    buildCommand: |
      pip install --upgrade pip
      pip install -r requirements.txt

    # üöÄ Start Command ‚Äî apply migrations, collect static files, then start Gunicorn
    startCommand: |
      python manage.py migrate && \
      python manage.py collectstatic --noinput && \
      gunicorn backend.wsgi:application

    # üåç Environment Variables for Django
    envVars:
      - key: SECRET_KEY
        value: "django-insecure-change-this-secret-key"   # üîê replace with a secure one before deploy
      - key: DEBUG
        value: "False"
      - key: ALLOWED_HOSTS
        value: "ecommerce-product-api.onrender.com,localhost,127.0.0.1"
      - key: DJANGO_SETTINGS_MODULE
        value: "backend.settings"
      - key: PYTHON_VERSION
        value: "3.12.6"
      - key: DATABASE_URL
        value: "sqlite:///db.sqlite3"
      - key: RENDER
        value: "True"
      - key: STATIC_ROOT
        value: "/opt/render/project/src/backend/staticfiles"
      - key: MEDIA_ROOT
        value: "/opt/render/project/src/backend/media"
      - key: CSRF_TRUSTED_ORIGINS
        value: "https://ecommerce-product-api.onrender.com"
